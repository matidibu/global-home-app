<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Home Assist | Concierge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loading-dots:after { content: ' .'; animation: dots 1s steps(5, end) infinite; }
        @keyframes dots { 0%, 20% { content: ' .'; } 40% { content: ' ..'; } 60% { content: ' ...'; } 80%, 100% { content: ''; } }
    </style>
</head>
<body class="bg-slate-100 font-sans text-slate-900">
    <header class="bg-indigo-950 text-white py-12 px-6 text-center shadow-xl">
        <h1 class="text-3xl font-black tracking-tighter uppercase">Global Home Assist</h1>
        <p class="text-indigo-400 mt-2 font-medium">Asistencia Inteligente para tu Viaje</p>
    </header>

    <main class="max-w-xl mx-auto -mt-10 p-4 pb-24">
        <div class="bg-white rounded-[2rem] shadow-2xl p-8 border border-slate-200">
            <div id="form-container" class="space-y-4">
                <input type="text" id="nacionalidad" placeholder="Â¿De dÃ³nde sos? (ej: Argentino)" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:ring-2 focus:ring-indigo-600">
                <input type="text" id="destino" placeholder="Â¿A dÃ³nde vas? (ej: Roma)" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:ring-2 focus:ring-indigo-600">
                <button onclick="generarAsistencia()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-black py-5 rounded-2xl transition-all shadow-lg active:scale-95 uppercase tracking-widest">
                    Planificar mi viaje
                </button>
            </div>

            <div id="loader" class="hidden py-12 text-center text-indigo-600 font-bold loading-dots">
                Buscando mejores opciones
            </div>

            <div id="resultado" class="hidden mt-8 space-y-8 animate-fade-in">
                
                <div class="bg-indigo-50 p-6 rounded-2xl border-l-4 border-indigo-600">
                    <p id="bienvenida" class="text-slate-800 font-medium italic"></p>
                </div>

                <div class="grid grid-cols-3 gap-3">
                    <a id="link-hospedaje" target="_blank" class="bg-white border border-slate-200 p-4 rounded-2xl text-center shadow-sm hover:shadow-md transition-shadow">
                        <span class="block text-3xl">ğŸ¨</span>
                        <span class="text-[10px] font-black text-slate-400 uppercase">Hotel</span>
                    </a>
                    <a id="link-autos" target="_blank" class="bg-white border border-slate-200 p-4 rounded-2xl text-center shadow-sm hover:shadow-md transition-shadow">
                        <span class="block text-3xl">ğŸš—</span>
                        <span class="text-[10px] font-black text-slate-400 uppercase">Auto</span>
                    </a>
                    <a id="link-tickets" target="_blank" class="bg-white border border-slate-200 p-4 rounded-2xl text-center shadow-sm hover:shadow-md transition-shadow">
                        <span class="block text-3xl">ğŸŸï¸</span>
                        <span class="text-[10px] font-black text-slate-400 uppercase">Tickets</span>
                    </a>
                </div>

                <div>
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">ğŸ“ Imperdibles</h3>
                    <ul id="puntos" class="space-y-3 text-slate-700 font-medium"></ul>
                </div>

                <div class="bg-red-50 p-6 rounded-2xl border border-red-100">
                    <h4 class="text-red-700 font-black text-xs uppercase mb-2">ğŸ†˜ Protocolo de Seguridad</h4>
                    <p id="emergencia" class="text-xs text-slate-600 leading-relaxed"></p>
                </div>

                <button onclick="enviarWhatsApp()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-2xl shadow-lg flex items-center justify-center gap-3 transition-transform active:scale-95">
                    <span>Enviar itinerario a mi WhatsApp</span>
                    <svg class="w-6 h-6 fill-current" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.588-5.946 0-6.556 5.332-11.888 11.888-11.888 3.176 0 6.161 1.237 8.404 3.48s3.481 5.229 3.481 8.406c0 6.555-5.332 11.887-11.891 11.887-2.007 0-3.974-.506-5.717-1.47l-6.264 1.644zm6.186-4.223l.369.219c1.455.863 3.111 1.319 4.811 1.319 5.232 0 9.488-4.257 9.488-9.489 0-2.536-1-4.92-2.817-6.737-1.817-1.817-4.201-2.817-6.737-2.817-5.23 0-9.488 4.258-9.488 9.49 0 1.83.523 3.618 1.512 5.163l.241.378-1.001 3.65 3.734-.979z"/></svg>
                </button>
            </div>
        </div>
    </main>

    <script>
        let datosActuales = null;

        async function generarAsistencia() {
            const nac = document.getElementById('nacionalidad').value;
            const dest = document.getElementById('destino').value;
            const resDiv = document.getElementById('resultado');
            const loader = document.getElementById('loader');
            
            if(!nac || !dest) return alert("Faltan datos.");

            resDiv.classList.add('hidden');
            loader.classList.remove('hidden');

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({nacionalidad: nac, destino: dest})
                });
                datosActuales = await response.json();

                document.getElementById('bienvenida').innerText = datosActuales.bienvenida;
                document.getElementById('emergencia').innerText = datosActuales.emergencia;
                document.getElementById('link-hospedaje').href = datosActuales.hospedaje;
                document.getElementById('link-autos').href = datosActuales.autos;
                document.getElementById('link-tickets').href = datosActuales.tickets;

                const lista = document.getElementById('puntos');
                lista.innerHTML = "";
                datosActuales.puntos.forEach(p => {
                    const li = document.createElement('li');
                    li.innerHTML = `<span class="text-indigo-600 mr-2">âœ”</span> ${p}`;
                    lista.appendChild(li);
                });

                loader.classList.add('hidden');
                resDiv.classList.remove('hidden');
            } catch (e) {
                alert("La IA estÃ¡ descansando. Intenta de nuevo.");
                loader.classList.add('hidden');
            }
        }

        function enviarWhatsApp() {
            if(!datosActuales) return;
            const texto = `*GLOBAL HOME ASSIST - Tu Itinerario*%0A%0AğŸ  ${datosActuales.bienvenida}%0A%0AğŸ“ *Imperdibles:*%0A- ${datosActuales.puntos.join('%0A- ')}%0A%0AğŸ†˜ *Seguridad:* ${datosActuales.emergencia}%0A%0AğŸ¨ *Hotel:* ${datosActuales.hospedaje}`;
            window.open(`https://wa.me/?text=${texto}`, '_blank');
        }
    </script>
</body>
</html>